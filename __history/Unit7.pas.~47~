unit Unit7;
interface
uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Math, Vcl.StdCtrls, VclTee.TeeGDIPlus,
  Data.DB, VCLTee.TeEngine, Vcl.ExtCtrls, VCLTee.TeeProcs, VCLTee.Chart,
  VCLTee.DBChart, VCLTee.Series;
type
  TForm7 = class(TForm)
    Label1: TLabel;
    SS: TEdit;
    Label2: TLabel;
    chislo_1: TEdit;
    Button1: TButton;
    Label4: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    Kolm: TEdit;
    Pirs: TEdit;
    Chart1: TChart;
    Series1: TBarSeries;
    Label3: TLabel;
    Korrel: TEdit;
    Label10: TLabel;
    Label11: TLabel;
    Edit1: TEdit;
    Label7: TLabel;
    Label8: TLabel;
    Interv: TEdit;
    Memo1: TMemo;
    Button2: TButton;
    procedure Button1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;
var
  Form7: TForm7;
implementation
           uses  Unit2;
{$R *.dfm}
procedure TForm7.Button1Click(Sender: TObject);
        var
             chislo: Double;
 s1: string;
 s2,s3: string;
 i,otstup,razryad,s: integer;
 vihod: array of real;
   Koef_Korr: Double; //Коэффициент корреляции
         mas_gist: array of integer; //экспер. частота
       Sr_Int: array of real;
       Teor_Chast: array of real;  //для значений теоретических частот(пирсон)
       Nakople_Teor_Chast: array of real;  //для накопленных значений теоретических частот(колмогоров)
       Nakople_Mas_Gist: array of integer; //для накопленных значений эксперим частот(колмогоров)
   f,size_int:real; //ширина интервала
   j,intervalov: integer;
   SR_KV_OTKL:real;//среднее квадратичное отклонение
   Sr_Ar:real;     //среднее арифметич.
   KOEF_OTKL:real;
   Disp: real; //дисперсия
   Par_A, Par_b: real; //параметры распределения a и b
   FX: real;   //плотность распределения
   Pirson: real;   //значение критерия Пирсона
   Max_nakople: real; //макс разница между накопленными частотами(колмогоров)
   Kolmogor: real; //значение критерия Колмогорова
   F_Korr: real; //корреляционная фунция
   Tau: integer; //задаваемый параметр для нахождения корр функции
   Sum_1, Sum_2, Sum_3, Sum_4, Sum_5: real; //для нахождения корр функции
   Disp_x, Disp_y: real; //Дисперсии сечений выборки
   Znach_Koef_Korr: real; //Для проверки коэффициента корреляции
begin
 ///обнуление исходных данных
   S:=0;
   chislo:=0;
   setlength(mas_gist, 0);
  setlength(Sr_Int, 0);
  setlength(Teor_Chast, 0);
  setlength(Nakople_Teor_Chast, 0);
  setlength(Nakople_Mas_Gist, 0);
  setlength(vihod,0);
  series1.Clear;      //обнуление гистограммы
  Kolmogor:=0;
   Pirson:=0;
   Koef_Korr:=0;
   Znach_Koef_Korr:=0;
    Intervalov:=0;
    Sum_1:=0;
    Sum_2:=0;
    Sum_3:=0;
    Sum_4:=0;
    Sum_5:=0;
    Sr_Ar:=0;
    Disp:= 0;
 ///считывание значения интервалов и указание длины динамических массивов
  Intervalov:=strtoint(Interv.Text);
  setlength(mas_gist, Intervalov);
  setlength(Sr_Int, Intervalov);
  setlength(Teor_Chast, Intervalov);
  setlength(Nakople_Teor_Chast, Intervalov);
  setlength(Nakople_Mas_Gist, Intervalov);
 S:=strtoint(SS.Text);
 setlength(vihod,s);
 //chislo:=strtoFloat(chislo_1.Text);
     //chislo:=0.23346576;
 //  Str(chislo,s3);
 s3:=chislo_1.Text;
   razryad :=(Length(s3)-2)div 2;  //количество знаков после запятой введенного числа
   otstup :=razryad + 1; //отступ после точки
    chislo:=strtoFloat(s3);
  for i:=0 to s-1 do begin
   chislo:=Sqr(chislo);
   Str(chislo,S1);
   s2:=Copy(s1,2+otstup,(Length(s3)-2)); //выделение элементов
  chislo:=StrToFloat(s2)/Power(10,(Length(s3)-2));
  vihod[i]:=chislo;
  end;
   ///заполняем интервалы
   size_int := 1/intervalov;
   f:=0;
   for j:=0 to intervalov-1 do begin
        mas_gist[j]:=0 ;
   end;
   for j:=0 to intervalov-1 do begin
     for i:=0 to s-1 do  begin
       if (vihod[i]>f) and (vihod[i]<=f+size_int) then mas_gist[j]:=mas_gist[j]+1 end;
   f:=f+size_int
   end;
     ///находим среднее значения интервалов(Sr_Int)
   Sr_Int[0]:=size_int/2; //первое среднее
   for i:=1 to intervalov-1 do begin
   Sr_Int[i]:=size_int+Sr_Int[i-1] end;
     ///находим выборочную среднюю (Sr_Ar)
   for i:=0 to intervalov-1 do begin
     Sr_Ar:=Sr_Ar+Sr_Int[i]*mas_gist[i] end;
     Sr_Ar:=Sr_Ar/s;
     ///находим  выборочную дисперсию(Disp)
   for i:=0 to intervalov-1 do begin
     Disp:=Disp + mas_gist[i]*Sqr(Sr_Int[i] - Sr_Ar) end;
     Disp:=Disp/s;
     ///находим выборочное среднеквадратичное отклонение(SR_KV_OTKL)
     SR_KV_OTKL:=Sqrt(Disp);
     ///находим параметры распределения (Par_A, Par_b)
     Par_A:=Sr_Ar - Sqrt(3)*SR_KV_OTKL;
     Par_B:=Sr_Ar + Sqrt(3)*SR_KV_OTKL;
     ///находим предполагаемую плотность распределения Fx
     FX:=1/(Par_b-Par_A);
     ///находим теоретические частоты (первое и последнее значения считаются отдельно)
     Teor_Chast[0]:=s*(size_int - Par_A)*FX;
     Teor_Chast[Intervalov-1]:=s*(Par_b - (1 - size_int))*FX;
     for i:=1 to intervalov-2 do begin
       Teor_Chast[i]:=s*(Sr_Int[i+1] - Sr_Int[i])*FX  end;
     ///Находим значение критерия Пирсона
     for i:=0 to intervalov-1 do begin
     Pirson:=Pirson + Sqr(mas_gist[i] -  Teor_Chast[i])/Teor_Chast[i] end;
 ///создаем массивы с накопленными частотами(теор и практич) и находим максимульную разницу между накопленными частотами
     Nakople_Mas_Gist[0]:=Mas_Gist[0];
     Nakople_Teor_Chast[0]:=Teor_Chast[0];
     Max_nakople:=Nakople_Mas_Gist[0] - Nakople_Teor_Chast[0]; //начальный максимум
     for i:=1 to intervalov-1 do begin
       Nakople_Mas_Gist[i]:=Nakople_Mas_Gist[i-1]+Mas_Gist[i];
       Nakople_Teor_Chast[i]:=Nakople_Teor_Chast[i-1]+Teor_Chast[i];
       if Nakople_Mas_Gist[i] - Nakople_Teor_Chast[i] > Max_nakople then Max_nakople:=Nakople_Mas_Gist[i] - Nakople_Teor_Chast[i]
     end;
     Kolmogor:=Max_nakople/Sqrt(S);
     ///Находим корреляционную функцию (F_Korr)
     Tau:=3;
     for i:=0 to s-Tau-1 do begin
       ///Суммы для корр. функции
       Sum_1:=Sum_1 + vihod[i]*vihod[i+Tau];
       Sum_2:=Sum_2 + vihod[i];
       Sum_3:=Sum_3 + vihod[i+Tau];
       ///Суммы для дисперсии сечений выборки
       Sum_4:=Sum_4 + Sqr(vihod[i]);
       Sum_5:=Sum_5 + Sqr(vihod[i+Tau]);
     end;
     ///Находим значение корр. функции (F_Korr)
     F_Korr:= (1/(S-Tau))*Sum_1 - (1/Sqr(S-Tau))*Sum_2*Sum_3;
     ///Находим значения дисперсий Disp_x и Disp_y
     Disp_x:= (1/(S-Tau))*Sum_4 - (1/Sqr(S-Tau))*Sqr(Sum_2);
     Disp_y:= (1/(S-Tau))*Sum_5 - (1/Sqr(S-Tau))*Sqr(Sum_3);
         ///Находим коэфф. корреляции (Koef_Korr)
     Koef_Korr:=ABS(F_Korr/Sqrt(Disp_x*Disp_y));
   ///Для проверки коэфф. корреляции (при вероятности p=0.95)
     Znach_Koef_Korr:= (1-0.05)*Sqrt(1/S);
   ///вывод значений
   Kolm.Text:= FloatToStr(Kolmogor);
    Pirs.Text:= FloatToStr(Pirson);
   Korrel.Text:= FloatToStr(Koef_Korr);
   edit1.Text:= FloatToStr(Znach_Koef_Korr);
    ///заполнение гистограммы
        for I := 0 to Intervalov-1 do  begin
        Series1.Add(mas_gist[i]);
        end;
     end;

end.
